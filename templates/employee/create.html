{% extends "base.html" %} {% block title %}Tambah Karyawan - Sistem Presensi
Karyawan{% endblock %} {% block content %}
<div class="mb-6">
  <h1 class="text-3xl font-bold text-gray-800">Tambah Karyawan</h1>
  <p class="text-gray-600 mt-2">Tambah data karyawan baru</p>
</div>

<div class="bg-white rounded-lg shadow p-6 max-w-3xl">
  <form method="POST">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block text-gray-700 font-semibold mb-2">NIK *</label>
        <input
          type="text"
          name="nik"
          required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <div>
        <label class="block text-gray-700 font-semibold mb-2"
          >Nama Lengkap *</label
        >
        <input
          type="text"
          name="full_name"
          required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <div>
        <label class="block text-gray-700 font-semibold mb-2">Email *</label>
        <input
          type="email"
          name="email"
          required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <div>
        <label class="block text-gray-700 font-semibold mb-2">Nomor HP</label>
        <input
          type="text"
          name="phone"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <div>
        <label class="block text-gray-700 font-semibold mb-2">Jabatan *</label>
        <input
          type="text"
          name="position"
          required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <div>
        <label class="block text-gray-700 font-semibold mb-2">Divisi *</label>
        <input
          type="text"
          name="division"
          required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
        />
      </div>

      <div>
        <label class="block text-gray-700 font-semibold mb-2"
          >Atasan Langsung</label
        >
        <select
          name="supervisor_id"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
        >
          <option value="">Pilih Atasan</option>
          {% for supervisor in supervisors %}
          <option value="{{ supervisor.id }}">
            {{ supervisor.full_name }}
          </option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label class="block text-gray-700 font-semibold mb-2"
          >Tanggal Masuk</label
        >
        <input
          type="date"
          name="hire_date"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
        />
      </div>
    </div>

    <!-- User Account Section -->
    <div class="mt-8 pt-6 border-t border-gray-200">
      <div class="mb-4">
        <label class="flex items-center space-x-2 cursor-pointer">
          <input
            type="checkbox"
            name="create_user"
            id="create_user"
            value="1"
            checked
            class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
            onchange="toggleUserFields()"
          />
          <span class="text-gray-700 font-semibold"
            >Buat User Account untuk Login</span
          >
        </label>
        <p class="text-sm text-gray-500 mt-1 ml-6">
          Centang untuk membuat akun login otomatis
        </p>
      </div>

      <div id="user_fields" class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
        <div>
          <label class="block text-gray-700 font-semibold mb-2">Username</label>
          <input
            type="text"
            name="username"
            id="username"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            placeholder="Auto-generate dari NIK"
          />
          <p class="text-xs text-gray-500 mt-1">
            Kosongkan untuk auto-generate dari NIK
          </p>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-2">Password</label>
          <input
            type="password"
            name="password"
            id="password"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
            placeholder="Auto-generate password"
          />
          <p class="text-xs text-gray-500 mt-1">
            Kosongkan untuk auto-generate (default: NIK)
          </p>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-2">Role</label>
          <select
            name="user_role"
            id="user_role"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
          >
            <option value="karyawan" selected>Karyawan</option>
            <option value="atasan">Atasan</option>
            <option value="hrd">HRD</option>
            <option value="admin">Admin</option>
          </select>
          <p class="text-xs text-gray-500 mt-1">
            Pilih role untuk user account
          </p>
        </div>
      </div>
    </div>

    <div class="mt-6 flex justify-end space-x-3">
      <a
        href="{{ url_for('employee.index') }}"
        class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"
      >
        Batal
      </a>
      <button
        type="submit"
        class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
      >
        Simpan
      </button>
    </div>
  </form>
</div>

<script>
  function toggleUserFields() {
    const checkbox = document.getElementById("create_user");
    const userFields = document.getElementById("user_fields");
    const inputs = userFields.querySelectorAll("input, select");

    if (checkbox.checked) {
      userFields.style.display = "grid";
      inputs.forEach((input) => {
        input.disabled = false;
        input.required = false; // Username dan password bisa auto-generate
      });
    } else {
      userFields.style.display = "none";
      inputs.forEach((input) => {
        input.disabled = true;
        input.required = false;
      });
    }
  }

  // Auto-generate username from NIK when NIK changes
  document
    .querySelector('input[name="nik"]')
    .addEventListener("input", function () {
      const nik = this.value.trim().toLowerCase();
      const usernameField = document.getElementById("username");
      if (nik && !usernameField.value) {
        usernameField.value = nik;
      }
    });

  // Initialize on page load
  document.addEventListener("DOMContentLoaded", function () {
    toggleUserFields();
  });
</script>
{% endblock %}
